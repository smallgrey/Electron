(()=>{"use strict";const n=function(){function n(){}return n.getCurrentTime=function(){var n=new Date,e=n.getMonth()+1,t=n.getDate()+1,o=n.getHours(),r=n.getMinutes(),i=n.getSeconds();return e<=9&&(e="0"+e),t<=9&&(t="0"+t),o<=9&&(o="0"+o),r<=9&&(r="0"+r),i<=9&&(i="0"+i),"["+n.getFullYear()+"-"+e+"-"+t+" "+o+":"+r+":"+i+"]"},n.error=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];console.error(n.getCurrentTime()+"["+e+"][error]: "+t)},n.debug=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];console.debug(n.getCurrentTime()+"["+e+"][debug]: "+t)},n.info=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];console.info(n.getCurrentTime()+"["+e+"][info]: "+t)},n._instance=new n,n}(),e=function(){function e(){}return e.subscribe=function(t,o){e.topics[t]||(e.topics[t]=[]);var r=++e.Uid;n.info("Observer","subscribe topic:"+t+", uid="+r),e.topics[t].push({token:r,func:o})},e.publish=function(n,t){if(!e.topics[n])return!1;for(var o=0;o<e.topics[n].length;o++)e.topics[n][o].func(t)},e.reconnect=function(){e.isReconnect=1},e.resetReconnect=function(){e.isReconnect=0},e.getReconnectStatus=function(){return e.isReconnect},e.topics={},e.Uid=-1,e.isReconnect=0,e}(),t=function(){function n(n){this.serviceTunnel=n.socket}return n.prototype.sendData=function(n){var e=JSON.stringify(n);this.serviceTunnel.socket&&this.serviceTunnel.sendData(e)},n.prototype.callbackResponse=function(n,e){n.response&&"function"==typeof n.response&&(this.serviceTunnel.rspFuncs[e]=n.response)},n.prototype.login=function(n,e){this.callbackResponse(e,1001);var t={cmd:1001,description:"tsdk_login",param:{loginParam:n}};this.sendData(t)},n.prototype.reconnectBindWs=function(n,e){this.callbackResponse(e,1002);var t={cmd:1002,description:"tsdk_reconnect_bind_ws",param:{userId:n}};this.sendData(t)},n.prototype.setBasicEvent=function(n){"function"==typeof n.onEvtLoginSuccess&&(this.serviceTunnel.notifyFuncs[1002]=n.onEvtLoginSuccess),"function"==typeof n.onEvtLoginFailed&&(this.serviceTunnel.notifyFuncs[1003]=n.onEvtLoginFailed)},n}(),o=function(){function n(n){var e=this;this.notifyFuncs=[],this.rspFuncs=[];var t=n.svraddr||"127.0.0.1",o=n.svrport||"3000",r="ws://";n.ssl&&(r="wss://"),this.socket=null,this.socket=new WebSocket(r+t+":"+o),this.socket.onopen=n.ready,this.socket.onclose=n.close,this.socket.onerror=n.error,this.socket.onmessage=function(n){var t=JSON.parse(n.data);if(t.notify&&t.notify>0){var o=t.notify;"function"==typeof e.notifyFuncs[o]&&e.notifyFuncs[o](t)}if(t.rsp&&t.rsp>0){var r=t.rsp;"function"==typeof e.rspFuncs[r]&&e.rspFuncs[r](t)}}}return n.prototype.sendData=function(n){this.socket.send(n)},n}(),r=function(){function n(n){this.serviceTunnel=n.socket}return n.prototype.sendData=function(n){var e=JSON.stringify(n);this.serviceTunnel.socket&&this.serviceTunnel.sendData(e)},n.prototype.callbackResponse=function(n,e){n.response&&"function"==typeof n.response&&(this.serviceTunnel.rspFuncs[e]=n.response)},n.prototype.searchLadp=function(n){this.callbackResponse(n,4001),this.sendData({cmd:4001,description:"tsdk_searchLadp",param:{searchParam:""}})},n.prototype.setBasicEvent=function(n){"function"==typeof n.onEvtLadpSearchResult&&(this.serviceTunnel.notifyFuncs[4002]=n.onEvtLadpSearchResult)},n}(),i=function(){function e(){if(e.wrapper)throw Error("tsdkManagerWrapper has exist");e.wrapper=this}return e.prototype.build=function(t,i,s,c,a,u){var p=this;if(!e.socketService||1!=e.socketService.socket.readyState){var l=new Promise((function(e,t){p.onWebsocketReady=function(t){e(""),n.info("tsdkManagerWrapper","websocket connect sucesss"),c&&"function"==typeof c&&c.call(null,"websocket链接成功")}})),f={svraddr:t,svrport:i,ssl:s,close:function(n){a&&"function"==typeof a&&a.call(null,n)},ready:this.onWebsocketReady,error:function(n){u&&"function"==typeof u&&u.call(null,n)}};return e.socketService=new o(f),e.tsdkManage=new r({socket:e.socketService}),l}n.info("tsdkManagerWrapper","websocket is connecting ")},e.getInstance=function(){return e.wrapper},e.prototype.onCloseWebsocket=function(){n.error("tsdkManagerWrapper","websocketService connect is closed")},e.prototype.searchLadp=function(){var n={response:{}},t=new Promise((function(e,t){n.response=function(n){e(n)}}));return e.tsdkManage.searchLadp(n),t},e.prototype.registerManageEvent=function(n){e.tsdkManage.setBasicEvent(n)},e.wrapper=new e,e}(),s=function(){function e(){if(e.wrapper)throw Error("tsdkLoginWrapper has exist");e.wrapper=this}return e.prototype.build=function(){n.info("tsdkLoginWrapper","tsdkLoginWrapper has build"),e.tsdkLogin=new t({socket:i.socketService})},e.getInstance=function(){return e.wrapper},e.prototype.login=function(n){var t={response:{}},o=new Promise((function(n,e){t.response=function(e){n(e)}}));return e.tsdkLogin.login(n,t),o},e.prototype.reconnectBindWs=function(n){var t={response:{}},o=new Promise((function(n,e){t.response=function(e){n(e)}}));return e.tsdkLogin.reconnectBindWs(n,t),o},e.prototype.registerLoginEvent=function(n){e.tsdkLogin.setBasicEvent(n)},e.wrapper=new e,e}();var c=function(n,e,t,o){return new(t||(t=Promise))((function(r,i){function s(n){try{a(o.next(n))}catch(n){i(n)}}function c(n){try{a(o.throw(n))}catch(n){i(n)}}function a(n){var e;n.done?r(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(s,c)}a((o=o.apply(n,e||[])).next())}))},a=function(n,e){var t,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(n,s)}catch(n){i=[6,n],o=0}finally{t=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};const u=function(){function t(){this.wrapper=s.getInstance(),this.wrapper.build(),this.registerLoginEvent()}return t.prototype.login=function(n,e){return c(this,void 0,void 0,(function(){var t;return a(this,(function(o){switch(o.label){case 0:return[4,this.wrapper.login(n)];case 1:return t=o.sent(),e(t),[2]}}))}))},t.prototype.reconnectBindWs=function(n,e){return c(this,void 0,void 0,(function(){var t;return a(this,(function(o){switch(o.label){case 0:return[4,this.wrapper.reconnectBindWs(n)];case 1:return t=o.sent(),e(t),[2]}}))}))},t.prototype.registerLoginEvent=function(){n.info("tsdkLoginService","registerLoginEvent"),this.wrapper.registerLoginEvent({onEvtLoginSuccess:t.handleOnEvtLoginSuccess,onEvtLoginFailed:t.handleonEvtLoginFailed})},t.handleOnEvtLoginSuccess=function(n){e.publish("onEvtLoginSuccess",n)},t.handleonEvtLoginFailed=function(n){e.publish("onEvtLoginFailed",n)},t}();const p=function(){function t(n,t,o,r){var s=this;this.wrapper=i.getInstance();var c=function(){r&&"function"==typeof r&&r(null)},a=function(){e.publish("onEvtWebSocketClose","服务器连接异常"),e.reconnect(),setTimeout((function(){s.wrapper.build(n,t,o,c,a,u)}),3e3)},u=function(){};this.wrapper.build(n,t,o,c,a,u),this.registerManagerEvent()}return t.prototype.searchLadp=function(n){return e=this,t=void 0,r=function(){var e;return function(n,e){var t,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(n,s)}catch(n){i=[6,n],o=0}finally{t=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(t){switch(t.label){case 0:return[4,this.wrapper.searchLadp()];case 1:return e=t.sent(),n(e),[2]}}))},new((o=void 0)||(o=Promise))((function(n,i){function s(n){try{a(r.next(n))}catch(n){i(n)}}function c(n){try{a(r.throw(n))}catch(n){i(n)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(n){n(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}));var e,t,o,r},t.prototype.registerManagerEvent=function(){n.info("tsdkManagerService","registerManagerEvent"),this.wrapper.registerManageEvent({onEvtLadpSearchResult:t.handleOnEvtLadpSearchResult})},t.handleOnEvtLadpSearchResult=function(n){e.publish("onEvtLadpSearchResult",n)},t}(),l=function(){function n(n){this.serviceTunnel=n.socket}return n.prototype.sendData=function(n){var e=JSON.stringify(n);this.serviceTunnel.socket&&this.serviceTunnel.sendData(e)},n.prototype.callbackResponse=function(n,e){n.response&&"function"==typeof n.response&&(this.serviceTunnel.rspFuncs[e]=n.response)},n.prototype.uploadFile=function(n,e){this.callbackResponse(e,2001),this.sendData({cmd:2001,description:"tsdk_upload_file",param:{file_sub_name:"文件标题",file:"test"}})},n.prototype.setBasicEvent=function(n){"function"==typeof n.onEvtUploadFileSuccess&&(this.serviceTunnel.notifyFuncs[2002]=n.onEvtUploadFileSuccess)},n}(),f=function(){function e(){if(e.wrapper)throw Error("tsdkMainWrapper has exist");e.wrapper=this}return e.prototype.build=function(){n.info("tsdkMainWrapper","tsdkMainWrapper has build"),e.tsdkMain=new l({socket:i.socketService})},e.getInstance=function(){return e.wrapper},e.prototype.uploadFile=function(n){var t={response:{}},o=new Promise((function(n,e){t.response=function(e){n(e)}}));return e.tsdkMain.uploadFile(n,t),o},e.prototype.registerMainEvent=function(n){e.tsdkMain.setBasicEvent(n)},e.wrapper=new e,e}();const v=function(){function t(){this.wrapper=f.getInstance(),this.wrapper.build(),this.registerMainEvent()}return t.prototype.uploadFile=function(n,e){return t=this,o=void 0,i=function(){var t;return function(n,e){var t,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(n,s)}catch(n){i=[6,n],o=0}finally{t=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(o){switch(o.label){case 0:return[4,this.wrapper.uploadFile(n)];case 1:return t=o.sent(),e(t),[2]}}))},new((r=void 0)||(r=Promise))((function(n,e){function s(n){try{a(i.next(n))}catch(n){e(n)}}function c(n){try{a(i.throw(n))}catch(n){e(n)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(n){n(t)}))).then(s,c)}a((i=i.apply(t,o||[])).next())}));var t,o,r,i},t.prototype.registerMainEvent=function(){n.info("tsdkMainService","registerMainEvent"),this.wrapper.registerMainEvent({onEvtUploadFileSuccess:t.handleOnEvtUploadFileSuccess})},t.handleOnEvtUploadFileSuccess=function(n){e.publish("onEvtUploadFileSuccess",n)},t}(),h=function(){function n(n){this.serviceTunnel=n.socket}return n.prototype.sendData=function(n){var e=JSON.stringify(n);this.serviceTunnel.socket&&this.serviceTunnel.sendData(e)},n.prototype.callbackResponse=function(n,e){n.response&&"function"==typeof n.response&&(this.serviceTunnel.rspFuncs[e]=n.response)},n.prototype.singlePersonChat=function(n,e){this.callbackResponse(e,3001);var t={cmd:3001,description:"tsdk_single_person_chat",param:{chatInfo:n}};this.sendData(t)},n.prototype.setBasicEvent=function(n){"function"==typeof n.onEvtNewsInComing&&(this.serviceTunnel.notifyFuncs[3002]=n.onEvtNewsInComing)},n}(),d=function(){function e(){if(e.wrapper)throw Error("tsdkChatWrapper has exist");e.wrapper=this}return e.prototype.build=function(){n.info("tsdkChatWrapper","tsdkChatWrapper has build"),e.tsdkChat=new h({socket:i.socketService})},e.getInstance=function(){return e.wrapper},e.prototype.singlePersonChat=function(n){var t={response:{}},o=new Promise((function(n,e){t.response=function(e){n(e)}}));return e.tsdkChat.singlePersonChat(n,t),o},e.prototype.registerChatEvent=function(n){e.tsdkChat.setBasicEvent(n)},e.wrapper=new e,e}();const g=function(){function t(){this.wrapper=d.getInstance(),this.wrapper.build(),this.registerChatEvent()}return t.prototype.singlePersonChat=function(n,e){return t=this,o=void 0,i=function(){var t;return function(n,e){var t,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(n,s)}catch(n){i=[6,n],o=0}finally{t=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(o){switch(o.label){case 0:return[4,this.wrapper.singlePersonChat(n)];case 1:return t=o.sent(),e(t),[2]}}))},new((r=void 0)||(r=Promise))((function(n,e){function s(n){try{a(i.next(n))}catch(n){e(n)}}function c(n){try{a(i.throw(n))}catch(n){e(n)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(n){n(t)}))).then(s,c)}a((i=i.apply(t,o||[])).next())}));var t,o,r,i},t.prototype.registerChatEvent=function(){n.info("tsdkChatService","registerChatEvent"),this.wrapper.registerChatEvent({onEvtNewsInComing:t.handleOnEvtNewsInComing})},t.handleOnEvtNewsInComing=function(n){e.publish("onEvtNewsInComing",n)},t}(),y=function(){function n(e){n.managerService=new p(e.svraddr,e.port,e.ssl,this.reconnectSucessCallback),n.loginService=new u,n.mainService=new v,n.tsdkChatService=new g,this.registerWebsocketEvent(),this.registerLoginEvent(),this.registerMainEvent(),this.registerChatEvent(),this.registerManageEvent()}return n.prototype.reconnectSucessCallback=function(){e.getReconnectStatus()&&(n.loginService=new u,n.mainService=new v,n.tsdkChatService=new g,n.managerService.registerManagerEvent(),e.resetReconnect()),e.publish("onEvtWebSocketConnect","服务器连接成功")},n.prototype.login=function(e,t){n.loginService.login(e,t)},n.prototype.reconnectBindWs=function(e,t){n.loginService.reconnectBindWs(e,t)},n.prototype.singlePersonChat=function(e,t){n.tsdkChatService.singlePersonChat(e,t)},n.prototype.searchLadp=function(e){n.managerService.searchLadp(e)},n.prototype.uploadFile=function(e,t){n.mainService.uploadFile(e,t)},n.prototype.notify=function(e,t){var o=n.__listeners[e];if(!o)return!1;for(var r=0;r<o.length;r++)"function"==typeof o[r]&&o[r](t)},n.prototype.on=function(e,t){n.__listeners[e]||(n.__listeners[e]=[]),n.__listeners[e].push(t)},n.prototype.registerLoginEvent=function(){var n=this;e.subscribe("onEvtLoginSuccess",(function(e){n.notify("onEvtLoginSuccess",e)})),e.subscribe("onEvtLoginFailed",(function(e){n.notify("onEvtLoginFailed",e)}))},n.prototype.registerMainEvent=function(){var n=this;e.subscribe("onEvtUploadFileSuccess",(function(e){n.notify("onEvtUploadFileSuccess",e)}))},n.prototype.registerChatEvent=function(){var n=this;e.subscribe("onEvtNewsInComing",(function(e){n.notify("onEvtNewsInComing",e)}))},n.prototype.registerManageEvent=function(){var n=this;e.subscribe("onEvtLadpSearchResult",(function(e){n.notify("onEvtLadpSearchResult",e)}))},n.prototype.registerWebsocketEvent=function(){var n=this;e.subscribe("onEvtWebSocketConnect",(function(e){n.notify("onEvtWebSocketConnect",e)})),e.subscribe("onEvtWebSocketClose",(function(e){n.notify("onEvtWebSocketClose",e)}))},n.__listeners={},n}(),b=function(){function e(){}return e.tsdkCreateClient=function(t,o){try{e.tsdkClient=new y(t)}catch(e){n.error("terminalSDK","terminal create failed..."+e)}return e.tsdkClient?(o&&"undefined"!=o.onEvtLoginSuccess&&e.tsdkClient.on("onEvtLoginSuccess",o.onEvtLoginSuccess),o&&"undefined"!=o.onEvtLoginFailed&&e.tsdkClient.on("onEvtLoginFailed",o.onEvtLoginFailed),o&&"undefined"!=o.onEvtUploadFileSuccess&&e.tsdkClient.on("onEvtUploadFileSuccess",o.onEvtUploadFileSuccess),o&&"undefined"!=o.onEvtNewsInComing&&e.tsdkClient.on("onEvtNewsInComing",o.onEvtNewsInComing),o&&"undefined"!=o.onEvtLadpSearchResult&&e.tsdkClient.on("onEvtLadpSearchResult",o.onEvtLadpSearchResult),o&&"undefined"!=o.onEvtWebSocketConnect&&e.tsdkClient.on("onEvtWebSocketConnect",o.onEvtWebSocketConnect),o&&"undefined"!=o.onEvtWebSocketClose&&e.tsdkClient.on("onEvtWebSocketClose",o.onEvtWebSocketClose),e.tsdkClient):""},e}();window.terminalSDK=b})();